<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store - Easy Access</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --s: #22c55e; --bg: #f1f5f9; --reject: #dc2626; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; }
        .container { max-width: 500px; margin: auto; padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: 'Rabar'; text-align: center; font-size: 1.1rem; }
        .btn { padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-family: 'Rabar'; width: 100%; font-weight: bold; color: white; transition: 0.3s; }
        .btn-p { background: var(--p); }
        .btn-s { background: var(--s); }
        .btn-reject { background: var(--reject); }
        .product { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .status { padding: 4px 8px; border-radius: 5px; font-size: 12px; font-weight: bold; }
        .pending { background: #fff3cd; color: #856404; }
        .completed { background: #d4edda; color: #155724; }
        .rejected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-ui" class="card" style="text-align:center;">
        <h2 style="color:var(--p); margin-bottom:5px;">ZANA STORE</h2>
        <p style="color:gray; font-size:14px;">Ø¨Û† Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù† Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•</p>
        <input type="number" id="userPhone" placeholder="0750 000 0000">
        <button class="btn btn-p" onclick="startApp()">Ú†ÙˆÙˆÙ†Û• Ù†Ø§Ùˆ ÙÚ•Û†Ø´Ú¯Ø§</button>
    </div>

    <div id="store-ui" style="display:none;">
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <span>Ø¨Û•Ø®ÛØ±Ù‡Ø§ØªÛŒ: <b id="displayPhone"></b></span>
            <button onclick="location.reload()" class="btn btn-reject" style="width:auto; padding:5px 10px;">Ú¯Û†Ú•ÛŒÙ†ÛŒ Ú˜Ù…Ø§Ø±Û•</button>
        </div>

        <div class="card">
            <h3>ğŸ® Ø¯Ø§ÙˆØ§Ú©Ø±Ø¯Ù†ÛŒ UC</h3>
            <div class="product"><span>60 UC - 1,500 Ø¯.Ú©</span> <button class="btn btn-s" style="width:auto;" onclick="sendOrder('60 UC')">Ø¯Ø§ÙˆØ§Ú©Ø±Ø¯Ù†</button></div>
            <div class="product"><span>325 UC - 7,250 Ø¯.Ú©</span> <button class="btn btn-s" style="width:auto;" onclick="sendOrder('325 UC')">Ø¯Ø§ÙˆØ§Ú©Ø±Ø¯Ù†</button></div>
            <div class="product"><span>660 UC - 14,500 Ø¯.Ú©</span> <button class="btn btn-s" style="width:auto;" onclick="sendOrder('660 UC')">Ø¯Ø§ÙˆØ§Ú©Ø±Ø¯Ù†</button></div>
        </div>

        <div class="card">
            <h3>ğŸ“œ Ø¨Ø§Ø±ÙˆØ¯Û†Ø®ÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†Øª</h3>
            <div id="user-orders">Ø¨Ø§Ø±Ø¯Û•Ú©Ø±ÛØª...</div>
        </div>
    </div>

    <div id="admin-ui" style="display:none;">
        <div class="card" style="background:var(--p); color:white;">
            <h3 style="margin:0;">Ù¾Ø§Ù†ÛÚµÛŒ Ø¨Û•Ú•ÛÙˆØ¨Û•Ø± (ZANA)</h3>
            <button onclick="location.reload()" class="btn" style="background:white; color:black; margin-top:10px; padding:5px;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        </div>
        <div id="admin-list">Ø¨Ø§Ø±Ø¯Û•Ú©Ø±ÛØª...</div>
    </div>
</div>

<script>
    const FB_URL = "https://zana-store-default-rtdb.firebaseio.com/";
    const TG_TOKEN = "7959366034:AAG0nCQqcG3YsImPf53SViggiUnlWkNFh1o"; 
    const TG_CHAT_ID = "6259019006";

    let myPhone = "";

    function startApp() {
        myPhone = document.getElementById('userPhone').value;
        if(myPhone.length < 10) return alert("ØªÚ©Ø§ÛŒÛ• Ú˜Ù…Ø§Ø±Û•ÛŒÛ•Ú©ÛŒ Ú•Ø§Ø³Øª Ø¨Ù†ÙˆÙˆØ³Û•");

        document.getElementById('auth-ui').style.display = 'none';

        if(myPhone === '07510074008') {
            document.getElementById('admin-ui').style.display = 'block';
            fetchAdminOrders();
            setInterval(fetchAdminOrders, 5000); // Ù†ÙˆÛØ¨ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒ Ø®Û†Ú©Ø§Ø± Ø¨Û† Ø¦Ø§Ø¯Ù…ÛŒÙ†
        } else {
            document.getElementById('store-ui').style.display = 'block';
            document.getElementById('displayPhone').innerText = myPhone;
            fetchUserOrders();
            setInterval(fetchUserOrders, 5000); // Ù†ÙˆÛØ¨ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒ Ø®Û†Ú©Ø§Ø± Ø¨Û† Ú©Ú•ÛŒØ§Ø±
        }
    }

    async function sendOrder(item) {
        const order = {
            phone: myPhone,
            item: item,
            status: 'pending',
            time: new Date().toLocaleTimeString('ku-IQ')
        };
        await fetch(`${FB_URL}/orders.json`, { method: 'POST', body: JSON.stringify(order) });
        
        // Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù†Ø§Ù…Û• Ø¨Û† ØªÛÙ„ÛÚ¯Ø±Ø§Ù…Û•Ú©Û•Øª
        fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${encodeURIComponent("ğŸ›’ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ!\nğŸ“¦ Ú©Ø§ÚµØ§: "+item+"\nğŸ“ Ú˜Ù…Ø§Ø±Û•: "+myPhone)}`);
        
        alert("Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§ âœ…");
        fetchUserOrders();
    }

    async function fetchUserOrders() {
        const res = await fetch(`${FB_URL}/orders.json`);
        const data = await res.json();
        let html = "";
        for(let id in data) {
            if(data[id].phone === myPhone) {
                let stTxt = data[id].status === 'pending' ? 'â³ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†' : (data[id].status === 'completed' ? 'âœ… ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§' : 'âŒ Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•');
                html += `<div class="product"><span>${data[id].item}</span><span class="status ${data[id].status}">${stTxt}</span></div>`;
            }
        }
        document.getElementById('user-orders').innerHTML = html || "Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Øª Ù†ÛŒÛŒÛ•";
    }

    async function fetchAdminOrders() {
        const res = await fetch(`${FB_URL}/orders.json`);
        const data = await res.json();
        let html = "";
        for(let id in data) {
            if(data[id].status === 'pending') {
                html += `<div class="card" style="border-right:5px solid var(--p);">
                    <b>ğŸ“ Ú©Ú•ÛŒØ§Ø±: ${data[id].phone}</b><br>ğŸ“¦ Ú©Ø§ÚµØ§: ${data[id].item}<br><small>${data[id].time}</small><hr>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-s" onclick="updateStatus('${id}', 'completed')">ÙˆÛ•Ø±Ú¯Ø±ØªÙ†</button>
                        <button class="btn btn-reject" onclick="updateStatus('${id}', 'rejected')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                    </div>
                </div>`;
            }
        }
        document.getElementById('admin-list').innerHTML = html || "<p style='text-align:center;'>Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ Ù†ÛŒÛŒÛ•</p>";
    }

    async function updateStatus(id, s) {
        await fetch(`${FB_URL}/orders/${id}.json`, { method: 'PATCH', body: JSON.stringify({status: s}) });
        fetchAdminOrders();
    }
</script>
</body>
</html>
