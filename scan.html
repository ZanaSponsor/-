<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store - Admin Control</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --s: #22c55e; --fastpay: #e31e24; --bg: #f1f5f9; --admin: #7c3aed; --reject: #dc2626; --warning: #f59e0b; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-family: 'Rabar'; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-family: 'Rabar'; font-weight: bold; width: 100%; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; border-radius: 6px; width: auto; margin: 2px; border: none; cursor: pointer; font-family: 'Rabar'; }
        .btn-admin { background: var(--admin); color: white; }
        .btn-reject { background: var(--reject); color: white; }
        #main-store, #admin-panel { display: none; grid-template-columns: 1fr 350px; gap: 20px; }
        .header { grid-column: 1/-1; display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 25px; border-radius: 15px; margin-bottom: 10px; }
        .history-item { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .pending { background: #fef3c7; color: #92400e; }
        .active { background: #dcfce7; color: #166534; }
        .rejected { background: #fee2e2; color: #991b1b; }
        @media (max-width: 850px) { #main-store, #admin-panel { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card" style="max-width:400px; margin:60px auto; text-align:center;">
        <h2 style="color:var(--p);">ZANA STORE</h2>
        <div id="login-form">
            <input type="text" id="lPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ ÛŒØ§Ù† Admin">
            <input type="password" id="lPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-p" onclick="login()">Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p onclick="toggleAuth(true)" style="cursor:pointer; color:gray; font-size:14px; margin-top:15px;">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±</p>
        </div>
        <div id="signup-form" style="display:none;">
            <input type="text" id="rName" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ">
            <input type="number" id="rPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„">
            <input type="password" id="rPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-s" onclick="signup()">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù† Ùˆ Ù†Ø§Ø±Ø¯Ù† Ø¨Û† Ø¦Ø§Ø¯Ù…ÛŒÙ†</button>
            <p onclick="toggleAuth(false)" style="cursor:pointer; color:gray; font-size:14px; margin-top:15px;">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</p>
        </div>
    </div>

    <div id="wait-screen" class="card" style="display:none; text-align:center; max-width:500px; margin:60px auto;">
        <h2 style="color:var(--warning);">âš ï¸ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†ÛŒ Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù† Ø¨Û•</h2>
        <p>Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†Øª Ù†ÛØ±Ø¯Ø±Ø§ Ø¨Û† Ø¦Ø§Ø¯Ù…ÛŒÙ†. ØªÚ©Ø§ÛŒÛ• Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û• ØªØ§ Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú© Ø¯Û•Ú©Ø±ÛØª.</p>
        <button class="btn btn-p" onclick="location.reload()">Ø¨Ø§Ø´Û•</button>
    </div>

    <div id="admin-panel">
        <div class="header" style="background:var(--admin); color:white;">
            <h3>Ø¨Û•Ø´ÛŒ Ø¨Û•Ú•ÛÙˆØ¨Û•Ø± (Ø¦Ø§Ø¯Ù…ÛŒÙ†)</h3>
            <button onclick="logout()" class="btn btn-sm" style="background:white;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        </div>
        
        <div class="card" style="grid-column: 1 / -1;">
            <h3 style="color:var(--admin);">ğŸ‘¤ Ù‡Û•Ú˜Ù…Ø§Ø±Û• Ù†ÙˆÛÛŒÛ• Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•Ú©Ø§Ù†</h3>
            <div id="admin-pending-users"></div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
            <h3 style="color:var(--s);">âœ… Ù‡Û•Ú˜Ù…Ø§Ø±Û• Ú†Ø§Ù„Ø§Ú©Û•Ú©Ø§Ù† Ùˆ Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†</h3>
            <div id="admin-history-users"></div>
        </div>
    </div>

    <div id="main-store">
        <div class="header"><h3>ZANA STORE</h3><button onclick="logout()" class="btn btn-sm" style="background:#fee2e2; color:#b91c1c;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button></div>
        <div class="card" style="grid-column: 1 / -1; text-align: center;">
            <h2 style="color:var(--s);">Ø¨Û•Ø®ÛØ±Ù‡Ø§ØªÛŒ! Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú©Û•.</h2>
            <p>Ù„ÛØ±Û•Ø¯Ø§ Ø¯Û•ØªÙˆØ§Ù†ÛŒØª Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†Øª Ø¦Û•Ù†Ø¬Ø§Ù… Ø¨Ø¯Û•ÛŒØª.</p>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('zana_store_db')) || { users: [], orders: [] };
    let loggedUser = JSON.parse(localStorage.getItem('zana_logged'));

    if(loggedUser) {
        if(loggedUser.phone === 'ADMIN') showAdmin();
        else checkStatus();
    }

    function toggleAuth(s) { document.getElementById('login-form').style.display=s?'none':'block'; document.getElementById('signup-form').style.display=s?'block':'none'; }

    function signup() {
        const n=document.getElementById('rName').value, p=document.getElementById('rPhone').value, ps=document.getElementById('rPass').value;
        if(!n || !p || !ps) return alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÙˆÙˆ Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•");
        
        // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø¨Û• Ø³ØªØ§ØªÛ†Ø³ÛŒ pending
        db.users.push({name:n, phone:p, pass:ps, status:'pending'});
        save();
        
        document.getElementById('auth-section').style.display='none';
        document.getElementById('wait-screen').style.display='block';
    }

    function login() {
        const p=document.getElementById('lPhone').value, ps=document.getElementById('lPass').value;
        if(p==='ADMIN' && ps==='112233') {
            loggedUser={phone:'ADMIN', name:'Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±'};
            localStorage.setItem('zana_logged', JSON.stringify(loggedUser));
            showAdmin(); return;
        }
        const u = db.users.find(x=>x.phone===p && x.pass===ps);
        if(u) {
            loggedUser = u;
            localStorage.setItem('zana_logged', JSON.stringify(u));
            checkStatus();
        } else alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù‡Û•ÚµÛ•Ù†");
    }

    function checkStatus() {
        const u = db.users.find(x=>x.phone === loggedUser.phone);
        if(u.status === 'pending') {
            document.getElementById('auth-section').style.display='none';
            document.getElementById('wait-screen').style.display='block';
        } else if(u.status === 'active') {
            document.getElementById('auth-section').style.display='none';
            document.getElementById('main-store').style.display='grid';
        } else {
            alert("Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ•.");
            logout();
        }
    }

    function showAdmin() {
        document.getElementById('auth-section').style.display='none';
        document.getElementById('admin-panel').style.display='grid';
        renderAdminLists();
    }

    function renderAdminLists() {
        const pendingList = document.getElementById('admin-pending-users');
        const historyList = document.getElementById('admin-history-users');
        
        const pendings = db.users.filter(u => u.status === 'pending');
        const history = db.users.filter(u => u.status !== 'pending');

        pendingList.innerHTML = pendings.map(u => `
            <div class="history-item">
                <div><b>${u.name}</b> (${u.phone})</div>
                <div>
                    <button class="btn-sm btn-admin" onclick="updateStatus('${u.phone}', 'active')">Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù†</button>
                    <button class="btn-sm btn-reject" onclick="updateStatus('${u.phone}', 'rejected')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                </div>
            </div>
        `).join('') || "Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©ÛŒ Ù†ÙˆÛ Ù†ÛŒÛŒÛ•";

        historyList.innerHTML = history.map(u => `
            <div class="history-item">
                <div><b>${u.name}</b> (${u.phone})</div>
                <span class="status-badge ${u.status}">${u.status === 'active' ? 'Ú†Ø§Ù„Ø§Ú©Û•' : 'Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•'}</span>
            </div>
        `).join('');
    }

    function updateStatus(phone, newStatus) {
        const u = db.users.find(x => x.phone === phone);
        u.status = newStatus;
        save();
        renderAdminLists();
        
        let msg = newStatus === 'active' ? "Ø³ÚµØ§ÙˆØŒ Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú© Ú©Ø±Ø§ âœ…" : "Ø³ÚµØ§ÙˆØŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âŒ";
        if(confirm("Ø¯Û•ØªÛ•ÙˆÛØª Ù†Ø§Ù…Û• Ø¨Û† ÙˆØ§ØªØ³Ø¦Ø§Ù¾ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø¨Ù†ÛØ±ÛŒØªØŸ")) {
            window.open(`https://wa.me/964${phone.substring(1)}?text=${encodeURIComponent(msg)}`);
        }
    }

    function logout() { localStorage.removeItem('zana_logged'); location.reload(); }
    function save() { localStorage.setItem('zana_store_db', JSON.stringify(db)); }
</script>
</body>
</html>
