<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store - Payment & History</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --accent: #ff0050; --s: #22c55e; --bg: #f8fafc; --fastpay: #e31e24; --fib: #ffd700; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        .container { max-width: 1100px; margin: auto; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Auth Styles */
        .auth-card { max-width: 400px; margin: 80px auto; text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-family: 'Rabar'; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-family: 'Rabar'; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }

        /* Store Layout */
        #main-store { display: none; grid-template-columns: 1fr 380px; gap: 20px; }
        .header { grid-column: 1/-1; display: flex; justify-content: space-between; align-items: center; background: var(--p); color: white; padding: 15px 25px; border-radius: 15px; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .product-item { border: 2px solid #f1f5f9; padding: 15px; border-radius: 15px; text-align: center; cursor: pointer; }
        .product-item:hover { border-color: var(--p); }

        /* History Table */
        .history-item { border-bottom: 1px solid #eee; padding: 12px 0; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { background: #fff3cd; color: #856404; padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: bold; }

        #payment-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center; }
        .qr-box { background: #eee; width: 200px; height: 200px; margin: 15px auto; display: flex; align-items: center; justify-content: center; border-radius: 15px; overflow: hidden; }
        .qr-box img { width: 100%; height: 100%; object-fit: cover; }

        @media (max-width: 850px) { #main-store { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card auth-card">
        <h2 id="auth-title">Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</h2>
        <div id="login-fields">
            <input type="number" id="logPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„">
            <input type="password" id="logPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-p" onclick="login()">Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p onclick="toggleAuth(true)" style="cursor:pointer; color:var(--p); margin-top:15px;">Ø¦Û•Ú˜Ù…Ø§Ø±Ù… Ù†ÛŒÛŒÛ•ØŸ Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Ú©Û•</p>
        </div>
        <div id="signup-fields" style="display:none;">
            <input type="text" id="regName" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ">
            <input type="number" id="regPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„">
            <input type="password" id="regPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯ÛŒ Ù†ÙˆÛ">
            <button class="btn btn-s" onclick="signup()">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
            <p onclick="toggleAuth(false)" style="cursor:pointer; color:var(--p); margin-top:15px;">Ø¦Û•Ú˜Ù…Ø§Ø±Ù… Ù‡Û•ÛŒÛ•ØŸ Ø¨Ú†Û† Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</p>
        </div>
    </div>

    <div id="main-store">
        <div class="header">
            <h2 style="margin:0;">ZANA STORE</h2>
            <div>
                <span id="user-name" style="margin-right:15px;"></span>
                <button onclick="logout()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px 12px; border-radius:8px; cursor:pointer; font-family:'Rabar';">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
            </div>
        </div>

        <div>
            <div class="card">
                <h3>ğŸ’ Ú©Ø§ÚµØ§Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</h3>
                <div class="product-grid">
                    <div class="product-item" onclick="add('60 UC', 1500)">60 UC<br><b>1,500 Ø¯.Ú©</b></div>
                    <div class="product-item" onclick="add('325 UC', 7250)">325 UC<br><b>7,250 Ø¯.Ú©</b></div>
                    <div class="product-item" onclick="add('1000 Coins', 19000)">1000 C<br><b>19,000 Ø¯.Ú©</b></div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒ Ú©Ú•ÛŒÙ†Û•Ú©Ø§Ù†</h3>
                <div id="history-list">
                    <p style="color:#94a3b8; text-align:center;">Ù‡ÛŒÚ† Ú©Ú•ÛŒÙ†ÛÚ© Ù†ÛŒÛŒÛ•</p>
                </div>
            </div>
        </div>

        <div class="card" style="height:fit-content; border:2px solid var(--p);">
            <h3>ğŸ›’ Ø³Û•Ø¨Û•ØªÛ•ÛŒ Ú©Ú•ÛŒÙ†</h3>
            <div id="cart-list"></div>
            <div style="font-size:22px; font-weight:bold; margin-top:15px; border-top:2px dashed #eee; padding-top:10px; display:flex; justify-content:space-between;">
                <span>Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ:</span><span id="total">0 Ø¯.Ú©</span>
            </div>
            <button class="btn btn-s" style="margin-top:15px;" onclick="openPay()">Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†</button>
        </div>
    </div>
</div>

<div id="payment-modal">
    <div class="card" style="max-width:400px; width:90%; text-align:center;">
        <h3 id="pay-title">Ø¬Û†Ø±ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</h3>
        
        <select id="payMethod" onchange="updateQR()">
            <option value="fastpay">FastPay (ÙØ§Ø³ØªÙ¾Û•ÛŒ)</option>
            <option value="fib">FIB (Ø¨Ø§Ù†Ú©ÛŒ Ù†ÛÙˆØ¯Û•ÙˆÚµÛ•ØªÛŒ Ø¹ÛØ±Ø§Ù‚)</option>
        </select>

        <div class="qr-box" id="qr-container">
            <span id="qr-placeholder">Ø¨Ø§Ø±Ú©Û†Ø¯</span>
        </div>
        [attachment_0](attachment)

        <p>Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•: <b id="pay-amt">0</b></p>
        <input type="text" id="txID" placeholder="Transaction ID (Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø³Úµ)">
        
        <button class="btn btn-p" onclick="confirmOrder()">Ù¾Ø´ØªÚ•Ø§Ø³ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Ø§Ø±Ø¯Ù†</button>
        <button onclick="document.getElementById('payment-modal').style.display='none'" style="background:none; border:none; color:gray; margin-top:10px; cursor:pointer; font-family:'Rabar';">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('zana_users')) || [];
    let currentUser = JSON.parse(localStorage.getItem('zana_logged'));
    let cart = [];

    if(currentUser) showStore();

    function toggleAuth(isSignup) {
        document.getElementById('login-fields').style.display = isSignup ? 'none' : 'block';
        document.getElementById('signup-fields').style.display = isSignup ? 'block' : 'none';
        document.getElementById('auth-title').innerText = isSignup ? 'Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ú˜Ù…Ø§Ø±' : 'Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
    }

    function signup() {
        const name = document.getElementById('regName').value;
        const phone = document.getElementById('regPhone').value;
        const pass = document.getElementById('regPass').value;
        if(!name || !phone || !pass) return alert("Ø®Ø§Ù†Û•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•ÙˆÛ•");
        if(users.find(u => u.phone === phone)) return alert("Ø¦Û•Ù… Ú˜Ù…Ø§Ø±Û•ÛŒÛ• Ù¾ÛØ´ØªØ± ØªÛ†Ù…Ø§Ø± Ú©Ø±Ø§ÙˆÛ•");
        
        users.push({ name, phone, pass, history: [] });
        localStorage.setItem('zana_users', JSON.stringify(users));
        alert("Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ Ø¨ÙˆÙˆØŒ Ø¦ÛØ³ØªØ§ Ø¨Ú†Û† Ú˜ÙˆÙˆØ±Û•ÙˆÛ•");
        toggleAuth(false);
    }

    function login() {
        const phone = document.getElementById('logPhone').value;
        const pass = document.getElementById('logPass').value;
        const user = users.find(u => u.phone === phone && u.pass === pass);
        if(user) {
            currentUser = user;
            localStorage.setItem('zana_logged', JSON.stringify(user));
            showStore();
        } else { alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù‡Û•ÚµÛ•Ù†"); }
    }

    function logout() { localStorage.removeItem('zana_logged'); location.reload(); }

    function showStore() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-store').style.display = 'grid';
        document.getElementById('user-name').innerText = "ğŸ‘¤ " + currentUser.name;
        renderHistory();
    }

    function add(n, p) { cart.push({n, p}); renderCart(); }

    function renderCart() {
        const cl = document.getElementById('cart-list');
        cl.innerHTML = ""; let t = 0;
        cart.forEach((i, idx) => {
            t += i.p;
            cl.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>${i.n}</span><span>${i.p.toLocaleString()} <button onclick="cart.splice(${idx},1);renderCart()" style="color:red; border:none; background:none; cursor:pointer;">âœ•</button></span>
            </div>`;
        });
        document.getElementById('total').innerText = t.toLocaleString() + " Ø¯.Ú©";
        document.getElementById('pay-amt').innerText = t.toLocaleString() + " Ø¯ÛŒÙ†Ø§Ø±";
    }

    function updateQR() {
        const method = document.getElementById('payMethod').value;
        const qrContainer = document.getElementById('qr-container');
        if(method === 'fastpay') {
            qrContainer.innerHTML = '<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=07758887488" alt="FastPay QR">';
        } else {
            qrContainer.innerHTML = '<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=FIB-ACCOUNT-DATA" alt="FIB QR">';
        }
    }

    function openPay() { 
        if(cart.length === 0) return alert("Ø³Û•Ø¨Û•ØªÛ• Ø®Ø§ÚµÛŒÛŒÛ•");
        document.getElementById('payment-modal').style.display = 'flex';
        updateQR();
    }

    function confirmOrder() {
        const tx = document.getElementById('txID').value;
        const method = document.getElementById('payMethod').value;
        if(!tx) return alert("ØªÚ©Ø§ÛŒÛ• Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø³Úµ (TXID) Ø¨Ù†ÙˆÙˆØ³Û•");

        const order = {
            date: new Date().toLocaleString('ku-IQ'),
            items: cart.map(i => i.n).join(' + '),
            total: document.getElementById('total').innerText,
            status: 'Ù„Û• Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒÛ• â³',
            method: method,
            txid: tx
        };

        const userIdx = users.findIndex(u => u.phone === currentUser.phone);
        users[userIdx].history.unshift(order);
        localStorage.setItem('zana_users', JSON.stringify(users));
        
        currentUser = users[userIdx];
        localStorage.setItem('zana_logged', JSON.stringify(currentUser));

        // WhatsApp Message
        let msg = `*Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ*%0A*Ú©Ú•ÛŒØ§Ø±:* ${currentUser.name}%0A*Ú©Û†:* ${order.total}%0A*Ø¬Û†Ø±ÛŒ Ù¾Ø§Ø±Û•Ø¯Ø§Ù†:* ${method}%0A*TXID:* ${tx}%0A*Ú©Ø§ÚµØ§Ú©Ø§Ù†:* ${order.items}`;
        window.open(`https://wa.me/9647758887488?text=${msg}`, '_blank');

        alert("Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§ Ùˆ Ø¦ÛØ³ØªØ§ Ù„Û• Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒÛ•");
        cart = []; renderCart(); renderHistory();
        document.getElementById('payment-modal').style.display = 'none';
    }

    function renderHistory() {
        const hl = document.getElementById('history-list');
        if(!currentUser.history || currentUser.history.length === 0) return;
        hl.innerHTML = "";
        currentUser.history.forEach(h => {
            hl.innerHTML += `<div class="history-item">
                <div>
                    <b>${h.items}</b><br>
                    <small>${h.date} | ${h.total}</small>
                </div>
                <span class="status-badge">${h.status}</span>
            </div>`;
        });
    }
</script>
</body>
</html>
