<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store Pro</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --s: #22c55e; --bg: #f1f5f9; --reject: #dc2626; --fastpay: #e31e24; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; color: #334155; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-family: 'Rabar'; }
        .btn { padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-family: 'Rabar'; width: 100%; font-weight: bold; color: white; transition: 0.3s; }
        .btn-p { background: var(--p); } .btn-s { background: var(--s); } .btn-r { background: var(--reject); }
        .item-row { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .status { padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .pending { background: #fef3c7; color: #92400e; }
        .completed { background: #dcfce7; color: #166534; }
        .rejected { background: #fee2e2; color: #991b1b; }
        #pay-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-ui" class="card" style="text-align:center;">
        <h2 style="color:var(--p);">ZANA STORE</h2>
        <input type="number" id="userPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ Ø¨Ù†ÙˆÙˆØ³Û•">
        <button class="btn btn-p" onclick="startApp()">Ú†ÙˆÙˆÙ†Û• Ù†Ø§ÙˆÛ•ÙˆÛ•</button>
    </div>

    <div id="store-ui" style="display:none;">
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <span>ğŸ“ <b id="displayPhone"></b></span>
            <button onclick="location.reload()" class="btn btn-r" style="width:auto; padding:5px 15px;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        </div>

        <div class="card">
            <h3>ğŸ® Ú©Ø§ÚµØ§Ú©Ø§Ù†ÛŒ Ø¨Û•Ø±Ø¯Û•Ø³Øª</h3>
            <div id="product-list">Ø¨Ø§Ø±Ø¯Û•Ú©Ø±ÛØª...</div>
        </div>

        <div class="card">
            <h3>ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒ Ù…Ø§Ù…Û•ÚµÛ•Ú©Ø§Ù†</h3>
            <div id="user-history"></div>
        </div>
    </div>

    <div id="admin-ui" style="display:none;">
        <div class="card" style="background:var(--p); color:white;">
            <h3>Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±ÛŒ Ø²Ø§Ù†Ø§</h3>
            <button onclick="location.reload()" class="btn" style="background:white; color:black;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        </div>
        
        <div class="card">
            <h4>â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ÚµØ§</h4>
            <input type="text" id="prodName" placeholder="Ù†Ø§ÙˆÛŒ Ú©Ø§ÚµØ§ (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û•: 60 UC)">
            <input type="number" id="prodPrice" placeholder="Ù†Ø±Ø® (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û•: 1500)">
            <button class="btn btn-s" onclick="addProduct()">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button>
        </div>

        <div class="card">
            <h4>ğŸ“¥ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ• Ú¯Û•ÛŒØ´ØªÙˆÙˆÛ•Ú©Ø§Ù†</h4>
            <div id="admin-orders"></div>
        </div>
    </div>
</div>

<div id="pay-modal">
    <div class="card" style="width:100%; max-width:400px; text-align:center;">
        <h3 style="color:var(--fastpay);">Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ø¨Û• FastPay</h3>
        <p>Ø¨Ú•ÛŒ <b id="modalPrice"></b> Ø¨Ù†ÛØ±Û• Ø¨Û†: <br><b style="font-size:1.5rem;">07510074008</b></p>
        <input type="text" id="orderDetails" placeholder="Ù†Ø§ÙˆÛŒ ÛŒØ§Ø±ÛŒ + Ø¦Ø§ÛŒØ¯ÛŒ">
        <p style="font-size:12px; color:gray;">Ù„ÛŒÙ†Ú©ÛÚ©ÛŒ ÙˆÛ•Ø³Úµ (ÙˆÛÙ†Û•) Ù„ÛØ±Û• Ø¯Ø§Ø¨Ù†Û:</p>
        <input type="text" id="receiptLink" placeholder="Ù„ÛŒÙ†Ú©ÛŒ ÙˆÛÙ†Û•ÛŒ ÙˆÛ•Ø³Úµ">
        <button class="btn btn-s" onclick="confirmOrder()">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</button>
        <button onclick="closeModal()" style="margin-top:10px; background:none; border:none; color:gray; cursor:pointer;">Ù¾Ø§Ø´Ú¯Û•Ø²Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•</button>
    </div>
</div>

<script>
    const FB_URL = "https://zana-store-default-rtdb.firebaseio.com/";
    const TG_TOKEN = "7959366034:AAG0nCQqcG3YsImPf53SViggiUnlWkNFh1o"; 
    const TG_CHAT_ID = "6259019006";

    let myPhone = "";
    let selectedItem = null;

    function startApp() {
        myPhone = document.getElementById('userPhone').value;
        if(myPhone.length < 10) return alert("Ú˜Ù…Ø§Ø±Û• Ù‡Û•ÚµÛ•ÛŒÛ•");
        document.getElementById('auth-ui').style.display = 'none';
        if(myPhone === '07510074008') {
            document.getElementById('admin-ui').style.display = 'block';
            fetchAdminOrders();
        } else {
            document.getElementById('store-ui').style.display = 'block';
            document.getElementById('displayPhone').innerText = myPhone;
            fetchProducts();
            fetchUserHistory();
        }
    }

    // --- Product Logic ---
    async function addProduct() {
        const n = document.getElementById('prodName').value;
        const p = document.getElementById('prodPrice').value;
        if(!n || !p) return;
        await fetch(`${FB_URL}/products.json`, { method: 'POST', body: JSON.stringify({name: n, price: p}) });
        alert("Ú©Ø§ÚµØ§ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§");
        location.reload();
    }

    async function fetchProducts() {
        const res = await fetch(`${FB_URL}/products.json`);
        const data = await res.json();
        let html = "";
        for(let id in data) {
            html += `<div class="item-row">
                <span><b>${data[id].name}</b> - ${data[id].price} Ø¯.Ú©</span>
                <button class="btn btn-s" style="width:auto; padding:5px 15px;" onclick="openPay('${data[id].name}', '${data[id].price}')">Ú©Ú•ÛŒÙ†</button>
            </div>`;
        }
        document.getElementById('product-list').innerHTML = html || "Ù‡ÛŒÚ† Ú©Ø§ÚµØ§ÛŒÛ•Ú© Ù†ÛŒÛŒÛ•";
    }

    // --- Order Logic ---
    function openPay(name, price) {
        selectedItem = {name, price};
        document.getElementById('modalPrice').innerText = price + " Ø¯.Ú©";
        document.getElementById('pay-modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('pay-modal').style.display = 'none'; }

    async function confirmOrder() {
        const details = document.getElementById('orderDetails').value;
        const receipt = document.getElementById('receiptLink').value;
        if(!details) return alert("ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ Ø¨Ù†ÙˆÙˆØ³Û•");

        const order = {
            phone: myPhone,
            item: selectedItem.name,
            price: selectedItem.price,
            details: details,
            receipt: receipt || "Ù†ÛŒÛŒÛ•",
            status: 'pending',
            time: new Date().toLocaleString('ku-IQ')
        };

        await fetch(`${FB_URL}/orders.json`, { method: 'POST', body: JSON.stringify(order) });

        // Telegram Notification
        const msg = `ğŸ›’ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ!\nğŸ“ Ú©Ú•ÛŒØ§Ø±: ${order.phone}\nğŸ“¦ Ú©Ø§ÚµØ§: ${order.item}\nğŸ“ ÙˆØ±Ø¯Û•Ú©Ø§Ø±ÛŒ: ${order.details}\nğŸ–¼ ÙˆÛ•Ø³Úµ: ${order.receipt}`;
        fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHAT_ID}&text=${encodeURIComponent(msg)}`);

        alert("Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§ Ø¨Û† Ø¦Ø§Ø¯Ù…ÛŒÙ†");
        closeModal();
        fetchUserHistory();
    }

    async function fetchUserHistory() {
        const res = await fetch(`${FB_URL}/orders.json`);
        const data = await res.json();
        let html = "";
        for(let id in data) {
            if(data[id].phone === myPhone) {
                html += `<div class="item-row">
                    <div><b>${data[id].item}</b><br><small>${data[id].time}</small></div>
                    <span class="status ${data[id].status}">${data[id].status}</span>
                </div>`;
            }
        }
        document.getElementById('user-history').innerHTML = html || "Ù…ÛÚ˜ÙˆÙˆÛŒÛ•Ú© Ù†ÛŒÛŒÛ•";
    }

    async function fetchAdminOrders() {
        const res = await fetch(`${FB_URL}/orders.json`);
        const data = await res.json();
        let html = "";
        for(let id in data) {
            if(data[id].status === 'pending') {
                html += `<div class="card" style="border-right:5px solid var(--p);">
                    <b>ğŸ“ Ú©Ú•ÛŒØ§Ø±: ${data[id].phone}</b><br>
                    ğŸ“¦ Ú©Ø§ÚµØ§: ${data[id].item}<br>ğŸ“ ${data[id].details}<br>
                    ğŸ–¼ ÙˆÛ•Ø³Úµ: <a href="${data[id].receipt}" target="_blank">Ø¨ÛŒÙ†ÛŒÙ†ÛŒ ÙˆÛÙ†Û•</a><hr>
                    <button class="btn btn-s" style="margin-bottom:5px;" onclick="updateOrder('${id}','completed')">ÙˆÛ•Ø±Ú¯Ø±ØªÙ† (ØªÛ•ÙˆØ§Ùˆ)</button>
                    <button class="btn btn-r" onclick="updateOrder('${id}','rejected')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                </div>`;
            }
        }
        document.getElementById('admin-orders').innerHTML = html || "Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ Ù†ÛŒÛŒÛ•";
    }

    async function updateOrder(id, s) {
        await fetch(`${FB_URL}/orders/${id}.json`, { method: 'PATCH', body: JSON.stringify({status: s}) });
        fetchAdminOrders();
    }
</script>
</body>
</html>
