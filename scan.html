<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store - Pro System</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --s: #22c55e; --fastpay: #e31e24; --fib: #000; --bg: #f8fafc; --admin: #7c3aed; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; }
        .container { max-width: 1100px; margin: auto; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Auth Styles */
        .auth-card { max-width: 400px; margin: 60px auto; text-align: center; }
        input, select { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-family: 'Rabar'; font-size: 16px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-family: 'Rabar'; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }
        .btn-admin { background: var(--admin); color: white; margin-top: 5px; padding: 8px 15px; font-size: 13px; }

        /* Layout */
        #main-store, #admin-panel { display: none; grid-template-columns: 1fr 380px; gap: 20px; }
        .header { grid-column: 1/-1; display: flex; justify-content: space-between; align-items: center; background: var(--p); color: white; padding: 15px 25px; border-radius: 15px; }
        .admin-header { background: var(--admin) !important; }
        
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; }
        .product-item { border: 2px solid #f1f5f9; padding: 20px; border-radius: 18px; text-align: center; cursor: pointer; transition: 0.2s; }
        .product-item:hover { border-color: var(--p); background: #f0f7ff; }
        .product-item b { display: block; color: var(--fastpay); margin-top: 5px; }

        .history-item { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { padding: 4px 12px; border-radius: 8px; font-size: 13px; font-weight: bold; }
        .pending { background: #fef3c7; color: #92400e; }
        .completed { background: #dcfce7; color: #166534; }

        #payment-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:1000; justify-content:center; align-items:center; }
        .modal-content { background: white; padding: 30px; border-radius: 25px; width: 90%; max-width: 450px; text-align: center; }
        .qr-box { background: #f8fafc; padding: 15px; border-radius: 15px; margin: 15px 0; border: 1px solid #eee; }

        @media (max-width: 850px) { #main-store, #admin-panel { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card auth-card">
        <h1 id="main-title" style="color:var(--p);">ZANA STORE</h1>
        <div id="login-form">
            <input type="text" id="lPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ ÛŒØ§Ù† Ù†Ø§ÙˆÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†">
            <input type="password" id="lPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-p" onclick="login()">Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p onclick="toggleAuth(true)" style="cursor:pointer; color:var(--p); margin-top:15px;">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ú˜Ù…Ø§Ø±</p>
        </div>
        <div id="signup-form" style="display:none;">
            <input type="text" id="rName" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ">
            <input type="number" id="rPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ (0750/0770/0780)">
            <input type="password" id="rPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-s" onclick="signup()">ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†</button>
            <p onclick="toggleAuth(false)" style="cursor:pointer; color:var(--p); margin-top:15px;">Ø¦Û•Ú˜Ù…Ø§Ø±Ù… Ù‡Û•ÛŒÛ•</p>
        </div>
    </div>

    <div id="main-store">
        <div class="header">
            <h2 style="margin:0;">ZANA ONLINE</h2>
            <div><span id="display-user"></span> <button onclick="logout()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px 10px; border-radius:8px; cursor:pointer; margin-right:10px;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button></div>
        </div>
        <div>
            <div class="card">
                <h3 style="margin-top:0;">ğŸ® Ú©Ø§ÚµØ§Ú©Ø§Ù† Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</h3>
                <div class="product-grid">
                    <div class="product-item" onclick="addToCart('60 UC', 1500)">60 UC<b>1,500 Ø¯.Ú©</b></div>
                    <div class="product-item" onclick="addToCart('325 UC', 7250)">325 UC<b>7,250 Ø¯.Ú©</b></div>
                    <div class="product-item" onclick="addToCart('660 UC', 14500)">660 UC<b>14,500 Ø¯.Ú©</b></div>
                    <div class="product-item" onclick="addToCart('1000 Coins', 19000)">1000 C<b>19,000 Ø¯.Ú©</b></div>
                </div>
            </div>
            <div class="card">
                <h3>ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒ Ú©Ú•ÛŒÙ†Û•Ú©Ø§Ù†Øª</h3>
                <div id="history-list"></div>
            </div>
        </div>
        <div class="card" style="height:fit-content; border:2px solid var(--p);">
            <h3>ğŸ›’ Ø³Û•Ø¨Û•ØªÛ•ÛŒ Ú©Ú•ÛŒÙ†</h3>
            <div id="cart-list"></div>
            <div style="font-size:22px; font-weight:bold; margin-top:15px; border-top:2px dashed #eee; padding-top:10px; display:flex; justify-content:space-between;">
                <span>Ú©Û†:</span><span id="total-price">0 Ø¯.Ú©</span>
            </div>
            <button class="btn btn-s" style="margin-top:15px;" onclick="checkOut()">ØªÛ•ÙˆØ§ÙˆÚ©Ø±Ø¯Ù†ÛŒ Ú©Ú•ÛŒÙ†</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="header admin-header">
            <h2 style="margin:0;">ZANA ADMIN (Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±)</h2>
            <button onclick="logout()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px 10px; border-radius:8px; cursor:pointer;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button>
        </div>
        <div class="card" style="grid-column: 1/-1;">
            <h3>ğŸ“¥ Ù‡Û•Ù…ÙˆÙˆ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
            <div id="admin-order-list"></div>
        </div>
    </div>
</div>

<div id="payment-modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">Ù¾Ø§Ø±Û•Ø¯Ø§Ù† Ùˆ Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛ•Ø³Úµ</h3>
        <select id="payWay" onchange="renderQR()">
            <option value="fastpay">FastPay - ÙØ§Ø³ØªÙ¾Û•ÛŒ</option>
            <option value="fib">FIB - Ø¦Û•Ù Ø¦Ø§ÛŒ Ø¨ÛŒ</option>
        </select>
        <div class="qr-box">
            <img id="qr-img" style="width:180px;">
            <p id="qr-info" style="font-weight:bold; margin-top:10px;"></p>
        </div>
        [attachment_0](attachment)
        <input type="text" id="txID" placeholder="Transaction ID (Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø³Úµ)">
        <button class="btn btn-p" onclick="finalizeOrder()">âœ… Ù†Ø§Ø±Ø¯Ù†ÛŒ ÙˆÛ•Ø³Úµ Ùˆ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ</button>
        <button onclick="closeModal()" style="color:gray; border:none; background:none; cursor:pointer; margin-top:15px;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('zana_official_db')) || [];
    let loggedUser = JSON.parse(localStorage.getItem('zana_official_logged'));
    let cart = [];

    if(loggedUser) loggedUser.name === 'ZANA' ? showAdmin() : initStore();

    function toggleAuth(isSignup) {
        document.getElementById('login-form').style.display = isSignup ? 'none' : 'block';
        document.getElementById('signup-form').style.display = isSignup ? 'block' : 'none';
    }

    function signup() {
        const name = document.getElementById('rName').value, phone = document.getElementById('rPhone').value, pass = document.getElementById('rPass').value;
        const prefix = phone.substring(0, 4);
        if(!['0750', '0770', '0780'].includes(prefix) || phone.length < 11) return alert("Ú˜Ù…Ø§Ø±Û•Ú©Û• Ø¯Û•Ø¨ÛØª Ø¨Û• 0750ØŒ 0770ØŒ ÛŒØ§Ù† 0780 Ø¯Û•Ø³ØªÙ¾ÛØ¨Ú©Ø§Øª!");
        if(users.find(u => u.phone === phone)) return alert("Ø¦Û•Ù… Ú˜Ù…Ø§Ø±Û•ÛŒÛ• Ù¾ÛØ´ØªØ± ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§ÙˆÛ•!");
        
        users.push({ name, phone, pass, history: [] });
        localStorage.setItem('zana_official_db', JSON.stringify(users));
        alert("ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù† Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆ Ø¨ÙˆÙˆØŒ Ø¦ÛØ³ØªØ§ Ø¨Ú†Û† Ú˜ÙˆÙˆØ±Û•ÙˆÛ•."); toggleAuth(false);
    }

    function login() {
        const input = document.getElementById('lPhone').value, pass = document.getElementById('lPass').value;
        if(input === 'ZANA' && pass === '112233') {
            loggedUser = { name: 'ZANA' };
            localStorage.setItem('zana_official_logged', JSON.stringify(loggedUser));
            showAdmin(); return;
        }
        const user = users.find(u => u.phone === input && u.pass === pass);
        if(user) {
            loggedUser = user;
            localStorage.setItem('zana_official_logged', JSON.stringify(loggedUser));
            initStore();
        } else alert("Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Ø§Ù† Ù‡Û•ÚµÛ•Ù†!");
    }

    function initStore() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('main-store').style.display = 'grid';
        document.getElementById('display-user').innerText = "ğŸ‘¤ " + loggedUser.name;
        renderHistory();
    }

    function showAdmin() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'grid';
        renderAdminOrders();
    }

    function logout() { localStorage.removeItem('zana_official_logged'); location.reload(); }

    function addToCart(n, p) { cart.push({n, p}); renderCart(); }

    function renderCart() {
        const list = document.getElementById('cart-list');
        list.innerHTML = ""; let total = 0;
        cart.forEach((i, idx) => { total += i.p; list.innerHTML += `<div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span>${i.n}</span><span>${i.p.toLocaleString()} <button onclick="cart.splice(${idx},1);renderCart()" style="color:red;border:none;background:none;cursor:pointer;">âœ•</button></span></div>`; });
        document.getElementById('total-price').innerText = total.toLocaleString() + " Ø¯.Ú©";
    }

    function checkOut() { if(cart.length > 0) { document.getElementById('payment-modal').style.display = 'flex'; renderQR(); } }
    function closeModal() { document.getElementById('payment-modal').style.display = 'none'; }

    function renderQR() {
        const way = document.getElementById('payWay').value;
        const img = document.getElementById('qr-img');
        const info = document.getElementById('qr-info');
        if(way==='fastpay') {
            img.src = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=07758887488";
            info.innerText = "07758887488";
        } else {
            img.src = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=FIB_ACCOUNT_ZANA";
            info.innerText = "Zana Adam FIB Account";
        }
    }

    function finalizeOrder() {
        const tx = document.getElementById('txID').value;
        if(!tx) return alert("ØªÚ©Ø§ÛŒÛ• TXID Ø¨Ù†ÙˆÙˆØ³Û•!");
        
        const order = { id: Date.now(), items: cart.map(i=>i.n).join(' + '), total: document.getElementById('total-price').innerText, date: new Date().toLocaleString('ku-IQ'), txid: tx, status: 'pending' };
        
        const uIdx = users.findIndex(u => u.phone === loggedUser.phone);
        users[uIdx].history.unshift(order);
        localStorage.setItem('zana_official_db', JSON.stringify(users));
        
        // WhatsApp notification to Admin
        const msg = `*Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÙˆÛ*%0A*Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±:* ${loggedUser.name}%0A*Ú©Û†:* ${order.total}%0A*TXID:* ${tx}%0A*Ú©Ø§ÚµØ§Ú©Ø§Ù†:* ${order.items}`;
        window.open(`https://wa.me/9647758887488?text=${encodeURIComponent(msg)}`, '_blank');

        alert("Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§!");
        cart = []; renderCart(); renderHistory(); closeModal();
    }

    function renderHistory() {
        const hl = document.getElementById('history-list');
        hl.innerHTML = (loggedUser.history || []).map(h => `<div class="history-item"><div><b>${h.items}</b><br><small>${h.date} | ${h.total}</small></div><span class="status-badge ${h.status}">${h.status==='pending'?'Ù„Û• Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Û•ÙˆÛ•ÛŒÛ• â³':'ØªÛ•ÙˆØ§ÙˆØ¨ÙˆÙˆ âœ…'}</span></div>`).join('');
    }

    function renderAdminOrders() {
        const al = document.getElementById('admin-order-list');
        let html = "";
        users.forEach(u => {
            u.history.forEach(h => {
                html += `<div class="history-item">
                    <div><b>${u.name} (${u.phone})</b><br>${h.items} - ${h.total}<br><small>ÙˆÛ•Ø³Úµ: ${h.txid}</small></div>
                    <div>
                        <span class="status-badge ${h.status}">${h.status==='pending'?'Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Û•':'Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø§ÙˆÛ•'}</span>
                        ${h.status==='pending' ? `<button class="btn btn-admin" onclick="approve('${u.phone}', ${h.id})">Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù†</button>` : ''}
                    </div>
                </div>`;
            });
        });
        al.innerHTML = html || "<p style='text-align:center;'>Ù‡ÛŒÚ† Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú© Ù†ÛŒÛŒÛ•</p>";
    }

    function approve(phone, id) {
        const uIdx = users.findIndex(u => u.phone === phone);
        const oIdx = users[uIdx].history.findIndex(o => o.id === id);
        users[uIdx].history[oIdx].status = 'completed';
        localStorage.setItem('zana_official_db', JSON.stringify(users));
        
        renderAdminOrders();
        
        const customerName = users[uIdx].name;
        const items = users[uIdx].history[oIdx].items;
        let formattedPhone = phone.startsWith('0') ? '964' + phone.substring(1) : phone;

        const msg = `*Ø³ÚµØ§Ùˆ ${customerName} Ú¯ÛŒØ§Ù†* ğŸŒ¹%0A*Ù…Ú˜Ø¯Û•!* Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Û•Øª Ø¨Û† (${items}) Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ *Ú†Ø§Ù„Ø§Ú© Ú©Ø±Ø§* âœ…%0AØ³ÙˆÙ¾Ø§Ø³ Ø¨Û† Ù…ØªÙ…Ø§Ù†Û•Ú©Û•Øª Ø¨Û• *ZANA STORE*.`;

        if(confirm("Ù…Ø§Ù…Û•ÚµÛ•Ú©Û• Ú†Ø§Ù„Ø§Ú© Ú©Ø±Ø§! Ù†Ø§Ù…Û•ÛŒ Ù…Ú˜Ø¯Û• Ø¨Û† Ú©Ú•ÛŒØ§Ø± Ø¨Ù†ÛØ±Ø¯Ø±ÛØªØŸ")) {
            window.open(`https://wa.me/${formattedPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    }
</script>
</body>
</html>
