<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zana Store - Full Admin Control</title>
    <link href="https://fonts.cdnfonts.com/css/rabar" rel="stylesheet">
    <style>
        :root { --p: #1e3a8a; --s: #22c55e; --fastpay: #e31e24; --bg: #f1f5f9; --admin: #7c3aed; --reject: #dc2626; --warning: #f59e0b; --gray: #64748b; }
        body { font-family: 'Rabar', sans-serif; background: var(--bg); margin: 0; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-family: 'Rabar'; box-sizing: border-box; }
        .btn { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-family: 'Rabar'; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn-p { background: var(--p); color: white; }
        .btn-s { background: var(--s); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; border-radius: 6px; width: auto; margin: 2px; border: none; cursor: pointer; font-family: 'Rabar'; }
        .btn-admin { background: var(--admin); color: white; }
        .btn-reject { background: var(--reject); color: white; }
        #main-store, #admin-panel { display: none; grid-template-columns: 1fr 350px; gap: 20px; }
        .header { grid-column: 1/-1; display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 25px; border-radius: 15px; margin-bottom: 10px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .product-item { background: white; border: 2px solid #f1f5f9; padding: 15px; border-radius: 15px; text-align: center; cursor: pointer; position: relative; }
        .history-item { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .active, .completed { background: #dcfce7; color: #166534; }
        .pending { background: #fef3c7; color: #92400e; }
        .rejected { background: #fee2e2; color: #991b1b; }
        .tab-btn { background: #e2e8f0; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-family: 'Rabar'; margin-left: 5px; }
        .tab-btn.active-tab { background: var(--admin); color: white; }
        @media (max-width: 850px) { #main-store, #admin-panel { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card" style="max-width:400px; margin:60px auto; text-align:center;">
        <h2 style="color:var(--p);">ZANA STORE</h2>
        <div id="login-form">
            <input type="text" id="lPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„ ÛŒØ§Ù† Admin">
            <input type="password" id="lPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-p" onclick="login()">Ú†ÙˆÙˆÙ†Û• Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
            <p onclick="toggleAuth(true)" style="cursor:pointer; color:gray; font-size:14px; margin-top:15px;">Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±ÛŒ Ù†ÙˆÛ</p>
        </div>
        <div id="signup-form" style="display:none;">
            <input type="text" id="rName" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ">
            <input type="number" id="rPhone" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…Û†Ø¨Ø§ÛŒÙ„">
            <input type="password" id="rPass" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯">
            <button class="btn btn-s" onclick="signup()">Ø¯Ø§ÙˆØ§Ú©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±</button>
            <p onclick="toggleAuth(false)" style="cursor:pointer; color:gray; font-size:14px; margin-top:15px;">Ù‡Û•Ú˜Ù…Ø§Ø±Ù… Ù‡Û•ÛŒÛ•</p>
        </div>
    </div>

    <div id="status-message" class="card" style="display:none; text-align:center; max-width:500px; margin:60px auto;">
        <h2 id="status-title" style="color:var(--warning);">âš ï¸ Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù† Ø¨Û•</h2>
        <p id="status-desc">Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ù„Û•Ú˜ÛØ± Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Û•ÙˆÛ•Ø¯Ø§ÛŒÛ•.</p>
        <button class="btn btn-p" onclick="logout()">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
    </div>

    <div id="main-store">
        <div class="header"><h3>ÙÚ•Û†Ø´Ú¯Ø§ÛŒ Ø²Ø§Ù†Ø§</h3><button onclick="logout()" class="btn btn-sm" style="background:#fee2e2; color:#b91c1c;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button></div>
        <div>
            <div class="card">
                <h3>ğŸ® Ú©Ø§ÚµØ§Ú©Ø§Ù†</h3>
                <div id="user-product-list" class="product-grid"></div>
            </div>
            <div class="card"><h3>ğŸ“œ Ù…ÛÚ˜ÙˆÙˆÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3><div id="history-list"></div></div>
        </div>
        <div class="card" style="height:fit-content;">
            <h3>ğŸ›’ Ø³Û•Ø¨Û•ØªÛ•</h3>
            <div id="cart-list"></div>
            <div style="font-size:20px; font-weight:bold; margin-top:15px; border-top:1px solid #eee; padding-top:10px; display:flex; justify-content:space-between;">
                <span>Ú©Û†:</span><span id="total-price">0 Ø¯.Ú©</span>
            </div>
            <button class="btn btn-s" style="margin-top:15px;" onclick="checkOut()">ØªÛ•ÙˆØ§ÙˆÚ©Ø±Ø¯Ù†ÛŒ Ú©Ú•ÛŒÙ†</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="header" style="background:var(--admin); color:white;"><h3>ADMIN CONTROL PANEL</h3><button onclick="logout()" class="btn btn-sm" style="background:white;">Ø¯Û•Ø±Ú†ÙˆÙˆÙ†</button></div>
        
        <div class="card" style="grid-column: 1 / -1;">
            <h3>â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ø§ÚµØ§</h3>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="newProdName" placeholder="Ù†Ø§ÙˆÛŒ Ú©Ø§ÚµØ§ (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û• 60 UC)">
                <input type="number" id="newProdPrice" placeholder="Ù†Ø±Ø® Ø¨Û• Ø¯ÛŒÙ†Ø§Ø±">
                <button class="btn btn-s" style="width: auto;" onclick="addProduct()">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button>
            </div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
            <h3>ğŸ‘¤ Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±Ø§ÛŒÛ•ØªÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Ø§Ù†</h3>
            <div style="margin-bottom: 15px;">
                <button class="tab-btn active-tab" id="tab-u-new" onclick="switchUserTab('pending')">Ù†ÙˆÛÛŒÛ•Ú©Ø§Ù†</button>
                <button class="tab-btn" id="tab-u-old" onclick="switchUserTab('processed')">Ú†Ø§Ù„Ø§Ú© Ùˆ Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†</button>
            </div>
            <div id="admin-user-list"></div>
        </div>

        <div class="card" style="grid-column: 1 / -1;">
            <h3>ğŸ“¥ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
            <div style="margin-bottom: 15px;">
                <button class="tab-btn active-tab" id="tab-o-new" onclick="switchOrderTab('pending')">Ù†ÙˆÛÛŒÛ•Ú©Ø§Ù†</button>
                <button class="tab-btn" id="tab-o-old" onclick="switchOrderTab('processed')">ØªÛ•ÙˆØ§ÙˆÚ©Ø±Ø§Ùˆ Ùˆ Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†</button>
            </div>
            <div id="admin-order-list"></div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('zana_pro_v4')) || { 
        users: [], 
        orders: [], 
        products: [
            {id: 1, n: '60 UC', p: 1500},
            {id: 2, n: '325 UC', p: 7250},
            {id: 3, n: '1000 Coins', p: 19000}
        ] 
    };
    let loggedUser = JSON.parse(localStorage.getItem('zana_pro_logged'));
    let cart = [];
    let currentUStatus = 'pending';
    let currentOStatus = 'pending';

    if(loggedUser) {
        if(loggedUser.phone === 'ADMIN') showAdmin();
        else checkStatus();
    }

    function toggleAuth(s) { document.getElementById('login-form').style.display=s?'none':'block'; document.getElementById('signup-form').style.display=s?'block':'none'; }

    function signup() {
        const n=document.getElementById('rName').value, p=document.getElementById('rPhone').value, ps=document.getElementById('rPass').value;
        if(p.length<11) return alert("Ú˜Ù…Ø§Ø±Û• Ù‡Û•ÚµÛ•ÛŒÛ•");
        db.users.push({name:n, phone:p, pass:ps, status:'pending'});
        save(); alert("Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù†ÛØ±Ø¯Ø±Ø§."); location.reload();
    }

    function login() {
        const p=document.getElementById('lPhone').value, ps=document.getElementById('lPass').value;
        if(p==='ADMIN' && ps==='112233') { loggedUser={phone:'ADMIN', name:'Admin'}; localStorage.setItem('zana_pro_logged', JSON.stringify(loggedUser)); showAdmin(); return; }
        const u = db.users.find(x=>x.phone===p && x.pass===ps);
        if(u) { loggedUser=u; localStorage.setItem('zana_pro_logged', JSON.stringify(u)); checkStatus(); } else alert("Ù‡Û•ÚµÛ•ÛŒÛ•");
    }

    function checkStatus() {
        const u = db.users.find(x=>x.phone === loggedUser.phone);
        if(u.status !== 'active') {
            document.getElementById('auth-section').style.display='none';
            document.getElementById('status-message').style.display='block';
            if(u.status === 'rejected') {
                document.getElementById('status-title').innerText = "âŒ Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ•";
                document.getElementById('status-desc').innerText = "Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú•Û•ØªÚ©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ•.";
            }
        } else initStore();
    }

    function initStore() {
        document.getElementById('auth-section').style.display='none';
        document.getElementById('main-store').style.display='grid';
        renderProducts();
        renderHistory();
    }

    function showAdmin() {
        document.getElementById('auth-section').style.display='none';
        document.getElementById('admin-panel').style.display='grid';
        renderAdminUsers();
        renderAdminOrders();
    }

    function logout() { localStorage.removeItem('zana_pro_logged'); location.reload(); }

    // Product Functions
    function addProduct() {
        const n = document.getElementById('newProdName').value;
        const p = document.getElementById('newProdPrice').value;
        if(!n || !p) return;
        db.products.push({id: Date.now(), n, p: parseInt(p)});
        save(); renderProducts();
        document.getElementById('newProdName').value = '';
        document.getElementById('newProdPrice').value = '';
    }

    function deleteProduct(id) {
        db.products = db.products.filter(x => x.id !== id);
        save(); renderProducts();
    }

    function renderProducts() {
        const list = document.getElementById('user-product-list');
        list.innerHTML = db.products.map(p => `
            <div class="product-item" onclick="addToCart('${p.n}', ${p.p})">
                ${loggedUser.phone === 'ADMIN' ? `<button onclick="event.stopPropagation(); deleteProduct(${p.id})" style="position:absolute; top:5px; right:5px; background:red; color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">Ã—</button>` : ''}
                ${p.n}<b>${p.p.toLocaleString()}</b>
            </div>
        `).join('');
    }

    // Cart & Order
    function addToCart(n, p) { let i=cart.find(x=>x.n===n); if(i) i.q++; else cart.push({n, p, q:1}); renderCart(); }
    function renderCart() {
        const l=document.getElementById('cart-list'); l.innerHTML=""; let t=0;
        cart.forEach((i,x)=>{ t+=i.p*i.q; l.innerHTML+=`<div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span>${i.n} x${i.q}</span><span>${(i.p*i.q).toLocaleString()} <button onclick="cart.splice(${x},1);renderCart()" style="color:red;border:none;background:none;">âœ•</button></span></div>`; });
        document.getElementById('total-price').innerText = t.toLocaleString() + " Ø¯.Ú©";
    }

    function checkOut() {
        if(cart.length === 0) return;
        const id = Math.floor(1000 + Math.random() * 9000);
        const order = { id, userPhone: loggedUser.phone, userName: loggedUser.name, items: cart.map(i=>`${i.n} x${i.q}`).join(', '), total: document.getElementById('total-price').innerText, date: new Date().toLocaleString('ku-IQ'), status: 'pending' };
        db.orders.unshift(order); save();
        window.open(`https://wa.me/9647510074008?text=Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ#${id}%0AÚ©Ú•ÛŒØ§Ø±:${loggedUser.name}%0AÚ©Ø§ÚµØ§:${order.items}%0AÚ©Û†:${order.total}`);
        cart=[]; renderCart(); renderHistory(); alert("Ù†ÛØ±Ø¯Ø±Ø§");
    }

    function renderHistory() {
        const my = db.orders.filter(o=>o.userPhone === loggedUser.phone);
        document.getElementById('history-list').innerHTML=my.map(h=>`<div class="history-item"><div><b>#${h.id}</b><br><small>${h.items}</small></div><span class="status-badge ${h.status}">${h.status}</span></div>`).join('');
    }

    // Admin Tabs & Management
    function switchUserTab(s) {
        currentUStatus = s;
        document.getElementById('tab-u-new').classList.toggle('active-tab', s==='pending');
        document.getElementById('tab-u-old').classList.toggle('active-tab', s==='processed');
        renderAdminUsers();
    }

    function switchOrderTab(s) {
        currentOStatus = s;
        document.getElementById('tab-o-new').classList.toggle('active-tab', s==='pending');
        document.getElementById('tab-o-old').classList.toggle('active-tab', s==='processed');
        renderAdminOrders();
    }

    function renderAdminUsers() {
        const list = currentUStatus === 'pending' ? db.users.filter(u=>u.status==='pending') : db.users.filter(u=>u.status!=='pending');
        document.getElementById('admin-user-list').innerHTML = list.map(u=>`<div class="history-item">
            <div><b>${u.name}</b> (${u.phone})</div>
            <div>
                ${u.status==='pending' ? `
                    <button class="btn-sm btn-admin" onclick="setUserStatus('${u.phone}','active')">Ú†Ø§Ù„Ø§Ú©Ú©Ø±Ø¯Ù†</button>
                    <button class="btn-sm btn-reject" onclick="setUserStatus('${u.phone}','rejected')">Ú•Û•ØªÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
                ` : `<span class="status-badge ${u.status}">${u.status}</span>`}
            </div>
        </div>`).join('') || "Ù‡ÛŒÚ† Ù†ÛŒÛŒÛ•";
    }

    function renderAdminOrders() {
        const list = currentOStatus === 'pending' ? db.orders.filter(o=>o.status==='pending') : db.orders.filter(o=>o.status!=='pending');
        document.getElementById('admin-order-list').innerHTML = list.map(o=>`<div class="history-item">
            <div><b>#${o.id} - ${o.userName}</b><br><small>${o.items} | ${o.total}</small></div>
            <div>
                ${o.status==='pending' ? `
                    <button class="btn-sm btn-admin" onclick="setOrdStatus('${o.id}','completed')">ØªÛ•ÙˆØ§Ùˆ</button>
                    <button class="btn-sm btn-reject" onclick="setOrdStatus('${o.id}','rejected')">Ú•Û•Øª</button>
                ` : `<span class="status-badge ${o.status}">${o.status}</span>`}
            </div>
        </div>`).join('') || "Ù‡ÛŒÚ† Ù†ÛŒÛŒÛ•";
    }

    function setUserStatus(p, s) {
        db.users.find(x=>x.phone===p).status = s; save(); renderAdminUsers();
        let msg = s==='active' ? "Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú†Ø§Ù„Ø§Ú© Ú©Ø±Ø§ âœ…" : "Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±Û•Ú©Û•Øª Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âŒ";
        if(confirm("Ù†Ø§Ù…Û• Ø¨Ù†ÛØ±Ø¯Ø±ÛØªØŸ")) window.open(`https://wa.me/964${p.substring(1)}?text=${encodeURIComponent(msg)}`);
    }

    function setOrdStatus(id, s) {
        const o = db.orders.find(x=>x.id==id); o.status=s; save(); renderAdminOrders();
        let msg = s==='completed' ? `Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ #${id} ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆ âœ…` : `Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ #${id} Ú•Û•ØªÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âŒ`;
        if(confirm("Ù†Ø§Ù…Û• Ø¨Ù†ÛØ±Ø¯Ø±ÛØªØŸ")) window.open(`https://wa.me/964${o.userPhone.substring(1)}?text=${encodeURIComponent(msg)}`);
    }

    function save() { localStorage.setItem('zana_pro_v4', JSON.stringify(db)); }
</script>
</body>
</html>
